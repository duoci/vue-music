(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-44f2387e"],{"15bf":function(t,s,e){"use strict";e("9354")},"47c2":function(t,s,e){"use strict";e("50b1")},"50b1":function(t,s,e){},"560f":function(t,s,e){},"612c":function(t,s,e){"use strict";var i=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"hotComments"},[e("div",{staticClass:"commentHeader"},[t._t("title")],2),t._l(t.comments,(function(s,i){return e("div",{key:i,staticClass:"commentItem"},[e("div",{staticClass:"commentCreatorAvatar"},[e("img",{attrs:{src:s.user.avatarUrl+"?param=100y100",alt:""},on:{click:function(e){return t.goToPersonal(s.user.userId)}}})]),e("div",{staticClass:"commentMain"},[e("div",{staticClass:"commentContent"},[e("span",{staticClass:"commentUserNickName",on:{click:function(e){return t.goToPersonal(s.user.userId)}}},[t._v(t._s(s.user.nickname)+": ")]),e("span",[t._v(t._s(s.content))])]),e("div",{staticClass:"replied"},t._l(s.beReplied,(function(i,a){return e("div",{key:a,staticClass:"repliedItem"},[e("span",{staticClass:"repliedUser",on:{click:function(e){return t.goToPersonal(s.user.userId)}}},[t._v("@"+t._s(i.user.nickname)+": ")]),e("span",{staticClass:"repliedContent"},[t._v(t._s(i.content))])])})),0),e("div",{staticClass:"commentBottom"},[e("div",{staticClass:"commentCreatedTime"},[t._v(" "+t._s(t._f("showDate")(s.time))+" ")]),e("div",{staticClass:"commentButtons"},[e("div",{class:s.liked?"likeCurrentComment":"",on:{click:function(e){return t.likeCurrentComment(s.liked,s.commentId)}}},[e("i",{staticClass:"iconfont icon-good"}),t._v(" "+t._s(s.likedCount)+" ")]),t._m(0,!0),t._m(1,!0)])])])])}))],2)},a=[function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",[e("i",{staticClass:"iconfont icon-zhuanfa"})])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",[e("i",{staticClass:"iconfont icon-pinglun"})])}],c=e("d930"),n=e("2f62"),l={name:"Comment",props:{comments:{type:Array,default(){return[]}},commentType:{type:String,default(){return""}},commentId:{type:String,default(){return""}},musicTitle:{type:String,default(){return""}},isHotComment:{type:Boolean,default(){return!0}}},methods:{...Object(n["b"])(["changeMusicDetailCardState"]),async likeCurrentComment(t,s){if(!this.$store.state.isLogin)return void this.$message.warning("只有登陆后才能点赞哦!");const e=Date.parse(new Date);let i;switch(this.commentType){case"album":i=3;break;case"musicList":i=2;break;case"music":i=0;break;case"mv":i=1;break;case"video":i=5;break}const a=await this.get("/comment/like",{id:this.commentId,cid:s,t:t?0:1,type:i,timestamp:e});200===a.code?this.$emit("getComment"):this.$message.error("点赞失败,请稍后重试!")},goToPersonal(t){this.$router.push({name:"personal",params:{uid:t}}),"music"===this.commentType&&this.changeMusicDetailCardState(!1)}},filters:{showDate(t){const s=new Date(t);return Object(c["a"])(s,"yyyy-MM-dd")}}},r=l,o=(e("15bf"),e("2877")),u=Object(o["a"])(r,i,a,!1,null,"65bbec1a",null);s["a"]=u.exports},"750e":function(t,s,e){"use strict";e("560f")},9354:function(t,s,e){},b258:function(t,s,e){"use strict";e.r(s);var i=function(){var t=this,s=t.$createElement,e=t._self._c||s;return t.musicListDetail?e("div",{staticClass:"musicListDetail"},[e("div",{staticClass:"listInfo"},[e("div",{staticClass:"listAvatar"},[e("img",{attrs:{src:t.musicListDetail.coverImgUrl,alt:""}})]),e("div",{staticClass:"right"},[e("div",{staticClass:"title"},[e("div",{staticClass:"titleTag"},[t._v("歌单")]),e("div",{staticClass:"titleContent"},[t._v(t._s(t.musicListDetail.name))])]),e("div",{staticClass:"user"},[e("div",{staticClass:"userAvatar"},[e("img",{attrs:{src:t.musicListDetail.creator.avatarUrl,alt:""}})]),e("div",{staticClass:"userName"},[t._v(" "+t._s(t.musicListDetail.creator.nickname)+" ")]),e("div",{staticClass:"createTime"},[t._v(t._s(t._f("showDate")(t.musicListDetail.createTime))+"创建")])]),e("div",{staticClass:"buttons"},[e("div",{staticClass:"buttonItem playAll",on:{click:t.playAll}},[e("i",{staticClass:"iconfont icon-bofang playAll"}),e("span",[t._v("播放全部")])]),t.isCreated?t._e():e("div",{staticClass:"buttonItem",on:{click:t.collectList}},[e("i",{staticClass:"iconfont icon-xihuan"}),e("span",[t._v(t._s(t.isSub?"已收藏":"收藏"))])]),t._m(0)]),e("div",{staticClass:"tags"},[t._v(" 标签： "),t._l(t.musicListDetail.tags,(function(s,i){return e("div",{key:i,staticClass:"tagItem"},[t._v(" "+t._s(s)+" ")])})),0==t.musicListDetail.tags.length?e("div",[t._v("暂无标签")]):t._e()],2),e("div",{staticClass:"otherInfo"},[e("div",{staticClass:"musicNum"},[t._v("歌曲 : "+t._s(t.musicListDetail.trackCount))]),e("div",{staticClass:"playCount"},[t._v("播放 : "+t._s(t.musicListDetail.playCount))])]),e("div",{staticClass:"desc"},[t._v(" 简介 : "+t._s(t.musicListDetail.description?t.musicListDetail.description:"暂无简介")+" ")])])]),e("div",{staticClass:"musicList"},[e("el-tabs",{attrs:{value:"first"},on:{"tab-click":t.clickTab}},[e("el-tab-pane",{attrs:{label:"歌曲列表",name:"first"}},[e("el-table",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.loadMore,expression:"loadMore"}],staticStyle:{width:"100%"},attrs:{data:t.musicListDetail.tracks,size:"mini","highlight-current-row":"",stripe:"",lazy:"","row-key":function(t){return t.id},"infinite-scroll-disabled":t.scrollLoadDisabled,"infinite-scroll-distance":1500,"infinite-scroll-immediate":!1},on:{"row-dblclick":t.clickRow}},[e("el-table-column",{attrs:{label:"",width:"60",type:"index",index:t.handleIndex}}),e("el-table-column",{attrs:{prop:"name",label:"音乐标题","min-width":"300"}}),e("el-table-column",{attrs:{prop:"ar[0].name",label:"歌手","min-width":"120"}}),e("el-table-column",{attrs:{prop:"al.name",label:"专辑","min-width":"170"}}),e("el-table-column",{attrs:{prop:"dt",label:"时长","min-width":"100"}})],1),e("div",{staticClass:"placeholder"})],1),e("el-tab-pane",{attrs:{label:"评论",name:"second"}},[e("div",{staticClass:"commentList"},[e("comment",{attrs:{comments:t.comments.comments,commentType:"musicList",commentId:t.musicListDetail.id+"",isHotComment:!t.comments.hotComments},on:{getComment:t.getMusicListComment}},[e("div",{attrs:{slot:"title"},slot:"title"},[t._v("最新评论")])])],1),e("div",{directives:[{name:"show",rawName:"v-show",value:t.comments.comments&&0!=t.comments.comments.length,expression:"comments.comments && comments.comments.length != 0"}],staticClass:"page"},[e("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:t.comments.total,small:"","page-size":50,"current-page":t.currentCommentPage},on:{"current-change":t.commentPageChange}})],1)]),e("el-tab-pane",{attrs:{label:"收藏者",name:"third"}},[e("user-list-card",{attrs:{userType:"musicListDetailPage",userList:t.followedsListData.followedsList,isLoad:t.followedsListData.isMore}}),0==t.followedsListData.followedsList.length&&1==t.followedsListData.isLoaded?e("div",{staticClass:"tips"},[t._v("暂无收藏者")]):t._e()],1)],1)],1)]):t._e()},a=[function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"buttonItem"},[e("i",{staticClass:"iconfont icon-zhuanfa"}),e("span",[t._v("分享")])])}],c=e("d930"),n=e("612c"),l=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.load,expression:"load"}],staticClass:"UserListCard",attrs:{"infinite-scroll-disabled":t.disabled,"infinite-scroll-distance":300,"infinite-scroll-immediate":!1}},t._l(t.userList,(function(s,i){return e("div",{key:i,staticClass:"userItemContainer",on:{click:function(e){return t.clickUser(s.userId)}}},[e("div",{staticClass:"userItem"},[e("div",{staticClass:"left"},[e("img",{staticClass:"avatar",attrs:{src:s.avatarUrl+"?param=200y200",alt:""}})]),e("div",{staticClass:"right"},[e("div",{staticClass:"nickName"},[t._v(t._s(s.nickname))]),e("div",{staticClass:"signature"},[t._v(" "+t._s(s.signature)+" ")]),"personalPage"==t.userType?e("div",{staticClass:"nums"},[e("div",{staticClass:"musicListNum"},[t._v(t._s("歌单: "+s.playlistCount))]),e("div",{staticClass:"fenge"},[t._v("|")]),e("div",{staticClass:"followedsNum"},[t._v(t._s("粉丝: "+s.followeds))])]):t._e()])])])})),0)},r=[],o={name:"UserListCard",props:{userList:{type:Array,default(){return[]}},isLoad:{type:Boolean,default(){return!1}},userType:{type:String,default(){return"personalPage"}}},data(){return{disabled:!0}},methods:{clickUser(t){this.$router.push({name:"personal",params:{uid:t}})},load(){this.$emit("bottomLoad"),this.disabled=!0}},watch:{userList(){!0===this.isLoad&&(0!==this.userList.length?this.disabled=!1:this.disabled=!0)}}},u=o,d=(e("47c2"),e("2877")),m=Object(d["a"])(u,l,r,!1,null,"6e25f1c2",null),h=m.exports,p=e("2f62"),f={name:"MusicListDetail",data(){return{musicListDetail:null,comments:{},currentCommentPage:1,isSub:!1,isCreated:!1,isCommentLoading:!1,scrollLoadDisabled:!1,followedsListData:{currentPage:1,followedsList:[],isMore:!1,isLoaded:!1}}},computed:{...Object(p["c"])(["isLogin","createdMusicList","musicListId","collectMusicList","musicId"])},components:{Comment:n["a"],UserListCard:h},created(){this.getMusicListDetail(),this.getUserMusicList(),this.getIsSub()},methods:{...Object(p["b"])(["updateMusicId","updateMusicList","updateCollectMusicList"]),async getMusicListDetail(){const t=Date.parse(new Date),s=await this.get("/playlist/detail",{id:this.$route.params.id,timestamp:t});this.musicListDetail=s.playlist,this.musicListDetail.tracks.forEach((t,s)=>{this.musicListDetail.tracks[s].dt=Object(c["b"])(t.dt)})},async getMusicListComment(t){const s=Date.parse(new Date);this.isCommentLoading=!0,"changePage"===t&&this.scrollToComment();const e=await this.get("/comment/playlist",{id:this.$route.params.id,offset:50*(this.currentCommentPage-1),limit:50,timestamp:s});this.comments=e,this.isCommentLoading=!1},scrollToComment(){const t=document.querySelector(".musicListDetail"),s=document.querySelector(".listInfo");t.scrollTo({behavior:"smooth",top:s.clientHeight-20})},commentPageChange(t){this.currentCommentPage=t,this.getMusicListComment("changePage")},async getMusicListFolloweds(){const t=await this.get("/playlist/subscribers",{id:this.$route.params.id,offset:20*(this.followedsListData.currentPage-1)});this.followedsListData.followedsList.push(...t.subscribers)},handleDOM(t,s){if(document.querySelector(".musicListDetail")){const e=document.querySelector(".musicListDetail").querySelectorAll(".el-table__row"),i=this.musicListDetail.tracks.findIndex(s=>s.id===t);if(-1!==i&&(e[i].children[0].querySelector(".cell").innerHTML='<div><i class="iconfont icon-yinliang"></i></div>',e[i].children[0].querySelector(".iconfont").classList.add("currentRow"),e[i].children[2].querySelector(".cell").classList.add("currentRow")),-1!==s){const t=this.musicListDetail.tracks.findIndex(t=>t.id===s);-1!==t&&(e[t].children[0].querySelector(".cell").innerHTML=`<div>${t+1<10?"0"+(t+1):t+1}</div>`,e[t].children[2].querySelector(".cell").classList.remove("currentRow"))}}},handleIndex(t){return t+=1,t<10?"0"+t:t},playAll(){this.updateMusicId(this.musicListDetail.tracks[0].id),this.updateMusicList({musicList:this.musicListDetail.tracks,musicListId:this.musicListDetail.id})},clickTab(t){"1"!==t.index||this.comments.comments?"2"!==t.index||this.followedsListData.isLoaded||(this.getMusicListFolloweds(),this.followedsListData.isLoaded=!0):this.getMusicListComment()},async getMusicDetail(t){if(!1===this.isMore)return;this.scrollLoadDisabled=!0;const s=await this.get("/song/detail",{ids:t});s.songs.forEach((t,e)=>{s.songs[e].dt=Object(c["b"])(t.dt)}),this.musicListDetail.tracks.push(...s.songs)},async clickRow(t){this.updateMusicId(t.id),this.musicListDetail.id!==this.musicListId&&this.updateMusicList({musicList:this.musicListDetail.tracks,musicListId:this.musicListDetail.id})},async getUserMusicList(){const t=Date.parse(new Date),s=await this.get("/user/playlist",{uid:window.localStorage.getItem("userId"),timestamp:t}),e=s.playlist,i=e.findIndex(t=>!0===t.subscribed);this.collectedMusicList=e.slice(i),this.updateCollectMusicList(this.collectedMusicList)},loadMore(){if(!this.isLogin)return void this.$message.error("请先进行登录操作!");let t=this.musicListDetail.trackIds.slice(this.musicListDetail.tracks.length);t.length>100&&(t=t.slice(0,100));let s="";t.forEach(t=>{s+=t.id+","}),s=s.substr(0,s.length-1),this.getMusicDetail(s)},getIsCreated(){this.isCreated=this.$store.state.createdMusicList.find(t=>t.id===Number(this.$route.params.id))},getIsSub(){const t=Number(this.$route.params.id);this.isSub=this.collectMusicList.find(s=>s.id===t)},async collectList(){this.isSub=!this.isSub;const t=Date.parse(new Date);await this.get("/playlist/subscribe",{id:this.$route.params.id,t:this.isSub?1:2,timestamp:t});this.getUserMusicList()}},watch:{musicId(t,s){this.handleDOM(t,s)},createdMusicList(t,s){0===s.length&&this.getIsSub()}},filters:{showDate(t){const s=new Date(t);return Object(c["a"])(s,"yyyy-MM-dd")},handleNum:c["c"]},async mounted(){this.isLogin&&(this.getIsCreated(),this.isCreated||this.getIsSub()),await this.getMusicListDetail(),this.$nextTick(()=>{this.$route.params.id===this.musicListId&&this.handleDOM(this.musicId)})}},g=f,L=(e("750e"),Object(d["a"])(g,i,a,!1,null,"54fb4d90",null));s["default"]=L.exports},d930:function(t,s,e){"use strict";function i(t,s){/(y+)/.test(s)&&(s=s.replace(RegExp.$1,(""+t.getFullYear()).substr(4-RegExp.$1.length)));const e={"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds()};for(const i in e)if(new RegExp(`(${i})`).test(s)){const t=""+e[i];s=s.replace(RegExp.$1,1===RegExp.$1.length?t:a(t))}return s}function a(t){return("00"+t).substr(t.length)}function c(t){return t>1e4?(t=(t/1e4).toFixed(1),t+"万"):t}function n(t){t=parseInt(t),t=t>1e4?Math.floor(t/1e3):Math.floor(t);let s=Math.floor(t/60),e=Math.floor(t%60);return s=s<10?"0"+s:s,e=e<10?"0"+e:e,`${s}:${e}`}function l(t){t=t.split(":");const s=parseInt(t[0]),e=parseInt(t[1]);return 60*s+e}e.d(s,"a",(function(){return i})),e.d(s,"c",(function(){return c})),e.d(s,"b",(function(){return n})),e.d(s,"d",(function(){return l}))}}]);
//# sourceMappingURL=chunk-44f2387e.f3c9e9f1.js.map